<div class="card">
  <div class="header">
    <h2>Inscritos en Rutas</h2>

    <div class="actions">
      <!-- Filtro Ruta -->
      <select [ngModel]="filtroRuta()" (ngModelChange)="filtroRuta.set($event); onRutaChange()">
        <option value="">Todas las rutas</option>
        <option *ngFor="let r of rutas" [value]="r.id">{{ r.id }} — {{ r.nombre }}</option>
      </select>

      <!-- Filtro Itinerario (ligado a ruta) -->
      <select [ngModel]="filtroItinerario()" (ngModelChange)="filtroItinerario.set($event)" [disabled]="!filtroRuta()">
        <option value="">{{ filtroRuta() ? 'Todos los itinerarios' : 'Seleccione una ruta' }}</option>
        <option *ngFor="let it of itinerariosFiltrados()" [value]="it.id">
          {{ it.id }} — {{ it.fecha }} {{ it.hora }}
        </option>
      </select>

      <!-- Buscador -->
      <input
        type="text"
        placeholder="Buscar por estudiante, ruta, fecha…"
        [ngModel]="query()"
        (ngModelChange)="query.set($event)" />

      <!-- Ir a inscribirse -->
      <a class="btn btn-primary" [routerLink]="['/formulario']">+ Nueva inscripción</a>
    </div>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Estudiante</th>
          <th>Ruta</th>
          <th>Itinerario</th>
          <th>Registro</th>
          <th>Observaciones</th>
          <th style="width:180px">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ins of inscritos()">
          <td>{{ ins.id }}</td>
          <td>{{ nombreEstudiante(ins.estudianteId) }}</td>
          <td>{{ ins.rutaId }} — {{ nombreRuta(ins.rutaId) }}</td>
          <td>{{ ins.itinerarioId }} — {{ descItinerario(ins.itinerarioId) }}</td>
          <td>{{ ins.fechaRegistro }}</td>
          <td>{{ ins.observaciones || '-' }}</td>
          <td class="row-actions">
            <button class="btn btn-sm" [routerLink]="['/listado-inscripciones/editar', ins.id]">Editar</button>
            <button class="btn btn-sm danger" (click)="eliminar(ins.id)">Borrar</button>
          </td>
        </tr>

        <tr *ngIf="inscritos().length === 0">
          <td colspan="7" class="empty">No hay inscripciones que coincidan con el filtro.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
