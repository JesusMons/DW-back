<div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow">
  <h2 class="text-xl font-bold mb-6">Editar Conductor #{{ form?.id }}</h2>

  <form *ngIf="form" (ngSubmit)="save()" class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Nombre -->
    <div>
      <label class="block font-semibold">Nombre *</label>
      <input [(ngModel)]="form.name" name="name" class="w-full border rounded px-3 py-2" required />
    </div>

    <!-- Documento -->
    <div>
      <label class="block font-semibold">Documento</label>
      <input [(ngModel)]="form.document" name="document" class="w-full border rounded px-3 py-2" />
    </div>

    <!-- Teléfono -->
    <div>
      <label class="block font-semibold">Teléfono</label>
      <input [(ngModel)]="form.phone" name="phone" class="w-full border rounded px-3 py-2" />
    </div>

    <!-- Email -->
    <div>
      <label class="block font-semibold">Email</label>
      <input type="email" [(ngModel)]="form.email" name="email" class="w-full border rounded px-3 py-2" />
    </div>

    <!-- Dirección -->
    <div class="md:col-span-2">
      <label class="block font-semibold">Dirección</label>
      <input [(ngModel)]="form.address" name="address" class="w-full border rounded px-3 py-2" />
    </div>

    <!-- Tipo de licencia -->
    <div>
      <label class="block font-semibold">Tipo de Licencia *</label>
      <select [(ngModel)]="form.type_licence" name="type_licence" class="w-full border rounded px-3 py-2" required>
        <option value="A2">A2</option>
        <option value="B1">B1</option>
        <option value="B2">B2</option>
        <option value="C1">C1</option>
        <option value="C2">C2</option>
        <option value="C3">C3</option>
      </select>
    </div>

    <!-- Vencimiento licencia -->
    <div>
      <label class="block font-semibold">Vencimiento Licencia</label>
      <input
        type="date"
        [value]="form.licenceExpiry ? (form.licenceExpiry | date:'yyyy-MM-dd') : null"
        (change)="onLicenceChange($event)"
        class="w-full border rounded px-3 py-2"
      />
    </div>

    <!-- Experiencia -->
    <div>
      <label class="block font-semibold">Años de experiencia</label>
      <input type="number" min="0" [(ngModel)]="form.experienceYears" name="experienceYears" class="w-full border rounded px-3 py-2" />
    </div>

    <!-- Estado -->
    <div>
      <label class="block font-semibold">Estado</label>
      <select [(ngModel)]="form.status" name="status" class="w-full border rounded px-3 py-2">
        <option value="ACTIVE">ACTIVO</option>
        <option value="INACTIVE">INACTIVO</option>
        <option value="SUSPENDED">SUSPENDIDO</option>
      </select>
    </div>

    <!-- Bus asignado -->
    <div class="md:col-span-2">
      <label class="block font-semibold">Bus asignado</label>
      <select [(ngModel)]="form.assignedBusId" name="assignedBusId" class="w-full border rounded px-3 py-2">
        <option [ngValue]="undefined">Sin asignar</option>
        <option *ngFor="let b of buses" [ngValue]="b.id">{{ b.plate }} — #{{ b.id }}</option>
      </select>
    </div>

    <!-- Foto (preview + input file) -->
    <div class="md:col-span-2">
      <label class="block font-semibold mb-2">Foto del conductor</label>

      <div class="flex items-start gap-4">
        <img [src]="previewUrl" alt="Preview" class="w-24 h-24 rounded-full object-cover border" />

        <div class="flex-1">
          <input
            type="file"
            accept="image/*"
            (change)="onPhotoChange($event)"
            class="block w-full text-sm text-gray-700
                   file:mr-4 file:py-2 file:px-4
                   file:rounded file:border-0
                   file:text-sm file:font-semibold
                   file:bg-blue-50 file:text-blue-700
                   hover:file:bg-blue-100"
          />

          <p class="text-xs text-gray-500 mt-2">
            * Simulación: este archivo <b>no</b> se sube. Copia manualmente la imagen a
            <code class="bg-gray-100 px-1 rounded">public/drivers/{{ selectedFileName || (form.photoUrl?.replace('/drivers/','') || 'archivo.jpg') }}</code>.
          </p>

          <div class="mt-2">
            <label class="block text-sm font-medium">o escribe el nombre del archivo directamente</label>
            <div class="flex gap-2">
              <span class="px-3 py-2 border rounded bg-gray-50 text-gray-600 select-none">/drivers/</span>
              <input
                [value]="(form.photoUrl || '').replace('/drivers/','')"
                (input)="form.photoUrl = '/drivers/' + ($any($event.target).value || 'default.jpg')"
                class="flex-1 border rounded px-3 py-2 text-sm"
                placeholder="carlos_gomez.jpg" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Acciones -->
    <div class="md:col-span-2 flex justify-end gap-2 mt-2">
      <button pButton type="button" label="Cancelar" class="!bg-gray-500 !border-none" (click)="cancel()"></button>
      <button pButton type="submit" label="Guardar" icon="pi pi-save" severity="primary"></button>
    </div>
  </form>
</div>
