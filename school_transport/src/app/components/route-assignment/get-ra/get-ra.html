<div class="card">
  <div class="flex justify-between mb-4">
    <h2 class="text-xl font-bold text-gray-700">Asignaciones de Rutas</h2>
    <button pButton label="Nueva Asignación" icon="pi pi-plus" severity="success" [routerLink]="['/route-assignment/add']"></button>
  </div>

  <p-table [value]="rows" [tableStyle]="{ 'min-width': '72rem' }" responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr>
        <th>ID</th>
        <th>Ruta</th>
        <th>Bus</th>
        <th>Conductor</th>
        <th>Inicio</th>
        <th>Fin</th>
        <th>Estado</th>
        <th class="text-center ">Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-r>
      <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.routeName }}</td>
        <td>{{ r.busPlate }}</td>
        <td>{{ r.driverName }}</td>
        <td>{{ r.startDate | date:'yyyy-MM-dd' }}</td>
        <td>{{ r.endDate ? (r.endDate | date:'yyyy-MM-dd') : '-' }}</td>
        <td><p-tag [value]="r.status" [severity]="statusSeverity(r.status)"></p-tag></td>

        <td class="flex gap-2 ">
          <!-- Ver detalle -->
          <button pButton icon="pi pi-eye" severity="info" class="p-1" (click)="showDetails(r)"></button>
          <!-- Editar -->
          <button pButton icon="pi pi-pencil" severity="warn" class="p-1" [routerLink]="['/route-assignment/edit', r.id]"></button>
          <!-- Desactivar -->
          <button pButton icon="pi pi-ban" severity="help" class="p-1" (click)="deactivate(r)"></button>
          <!-- Eliminar -->
          <button pButton icon="pi pi-trash" severity="danger" class="p-1" (click)="delete(r)"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Modal Detalle -->
<p-dialog header="Detalle de Asignación" [(visible)]="detailsVisible" [modal]="true" [style]="{ width: '42rem' }">
  <div *ngIf="selected" class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div><strong>ID:</strong> {{ selected.id }}</div>
    <div><strong>Estado:</strong> {{ selected.status }}</div>

    <div><strong>Ruta:</strong> {{ selected.routeName }} (#{{ selected.routeId }})</div>
    <div><strong>Bus:</strong> {{ selected.busPlate }} (#{{ selected.busId }})</div>

    <div><strong>Conductor:</strong> {{ selected.driverName }}</div>
    <div><strong>Inicio:</strong> {{ selected.startDate | date:'yyyy-MM-dd' }}</div>

    <div><strong>Fin:</strong> {{ selected.endDate ? (selected.endDate | date:'yyyy-MM-dd') : '—' }}</div>

    <div class="md:col-span-2 text-xs text-gray-500">
      Creado: {{ selected.createdAt | date:'short' }} · Actualizado: {{ selected.updatedAt | date:'short' }}
    </div>
  </div>
</p-dialog>
