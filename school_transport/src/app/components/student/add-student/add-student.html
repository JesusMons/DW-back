<div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow">
  <h2 class="text-xl font-bold mb-6">Registrar Estudiante</h2>

  <form (ngSubmit)="save()" class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Nombre -->
    <div>
      <label class="block font-semibold">Nombre</label>
      <input [(ngModel)]="form.name" name="name" class="w-full border rounded px-3 py-2" required />
    </div>

    <!-- Apellido -->
    <div>
      <label class="block font-semibold">Apellido</label>
      <input [(ngModel)]="form.last_name" name="last_name" class="w-full border rounded px-3 py-2" required />
    </div>

    <!-- Documento -->
    <div>
      <label class="block font-semibold">Documento</label>
      <input type="number" [(ngModel)]="form.document" name="document" class="w-full border rounded px-3 py-2" required />
    </div>

    <!-- Grado -->
    <div>
      <label class="block font-semibold">Grado</label>
      <input type="number" [(ngModel)]="form.grade" name="grade" class="w-full border rounded px-3 py-2" />
    </div>

    <!-- Nacimiento -->
    <div>
      <label class="block font-semibold">Fecha de Nacimiento</label>
      <input type="date"
             [value]="form.birthdate ? (form.birthdate | date:'yyyy-MM-dd') : null"
             (change)="form.birthdate = $any($event.target).valueAsDate"
             class="w-full border rounded px-3 py-2" />
    </div>

    <!-- Estado -->
    <div>
      <label class="block font-semibold">Estado</label>
      <select [(ngModel)]="form.status" name="status" class="w-full border rounded px-3 py-2">
        <option value="ACTIVO">ACTIVO</option>
        <option value="INACTIVO">INACTIVO</option>
        <option value="GRADUADO">GRADUADO</option>
      </select>
    </div>

    <!-- Dirección -->
    <div class="md:col-span-2">
      <label class="block font-semibold">Dirección</label>
      <input [(ngModel)]="form.address" name="address" class="w-full border rounded px-3 py-2" />
    </div>

    <!-- Teléfonos -->
    <div>
      <label class="block font-semibold">Teléfono</label>
      <input [(ngModel)]="form.phone" name="phone" class="w-full border rounded px-3 py-2" />
    </div>
    <div>
      <label class="block font-semibold">Teléfono Acudiente</label>
      <input [(ngModel)]="form.guardianPhone" name="guardianPhone" class="w-full border rounded px-3 py-2" />
    </div>

    <!-- Email -->
    <div class="md:col-span-2">
      <label class="block font-semibold">Email</label>
      <input type="email" [(ngModel)]="form.email" name="email" class="w-full border rounded px-3 py-2" />
    </div>

    <!-- Acudiente -->
    <div class="md:col-span-2">
      <label class="block font-semibold">Acudiente</label>
      <input [(ngModel)]="form.guardian" name="guardian" class="w-full border rounded px-3 py-2" required />
    </div>

    <!-- Contacto de emergencia -->
    <div>
      <label class="block font-semibold">Contacto Emergencia - Nombre</label>
      <input [(ngModel)]="form.emergencyContact!.name" name="ec_name" class="w-full border rounded px-3 py-2" />
    </div>
    <div>
      <label class="block font-semibold">Contacto Emergencia - Teléfono</label>
      <input [(ngModel)]="form.emergencyContact!.phone" name="ec_phone" class="w-full border rounded px-3 py-2" />
    </div>
    <div class="md:col-span-2">
      <label class="block font-semibold">Contacto Emergencia - Relación</label>
      <input [(ngModel)]="form.emergencyContact!.relationship" name="ec_rel" class="w-full border rounded px-3 py-2" />
    </div>

    <!-- Alergias -->
    <div class="md:col-span-2">
      <label class="block font-semibold">Alergias</label>
      <div class="flex gap-2">
        <input [(ngModel)]="allergyInput" name="allergyInput" placeholder="Ej: Maní"
               class="flex-1 border rounded px-3 py-2" />
        <button pButton type="button" icon="pi pi-plus" (click)="addAllergy()" severity="success"></button>
      </div>

      <ul class="mt-2 text-sm">
        <li *ngFor="let a of form.allergies; let i = index" class="flex items-center justify-between py-1 border-b">
          <span>{{ a }}</span>
          <button type="button" class="text-red-600 hover:underline" (click)="removeAllergy(i)">Eliminar</button>
        </li>
      </ul>
    </div>

    <!-- Acciones -->
    <div class="md:col-span-2 flex justify-end gap-2">
      <button pButton type="button" label="Cancelar" class="!bg-gray-500 !border-none" (click)="cancel()"></button>
      <button pButton type="submit" label="Guardar" icon="pi pi-save" severity="primary"></button>
    </div>
  </form>
</div>
