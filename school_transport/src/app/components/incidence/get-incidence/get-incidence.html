<div class="card">
  <!-- Título -->
  <h2 class="text-2xl font-bold mb-4 text-gray-700">Listado de Incidencias</h2>

  <!-- Botón Crear -->
  <div class="flex justify-end mb-4">
    <p-button label="Crear Incidencia" severity="success" [routerLink]="['/incidence/add']"></p-button>
  </div>

  <!-- Tabla -->
  <p-table [value]="rows" [tableStyle]="{ 'min-width': '70rem' }" responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr>
        <th>ID</th>
        <th>Bus</th>
        <th>Ruta</th>
        <th>Severidad</th>
        <th>Estado</th>
        <th>Reportada</th>
        <th>Reportó</th>
        <th class="text-center">Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-r>
      <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.busPlate }}</td>
        <td>{{ r.routeName }}</td>
        <td>
          <p-tag [value]="r.severity" [severity]="severityTag(r.severity)"></p-tag>
        </td>
        <td>
          <p-tag [value]="r.status" [severity]="statusSeverity(r.status)"></p-tag>
        </td>
        <td>{{ r.reportedAt | date:'yyyy-MM-dd HH:mm' }}</td>
        <td>{{ r.reportedBy }}</td>
        <td class="flex gap-2  ">
          <p-button icon="pi pi-eye" severity="info" class="p-1" (click)="showDetails(r)"></p-button>
          <p-button icon="pi pi-pencil" severity="warn" class="p-1" [routerLink]="['/incidence/edit', r.id]"></p-button>
          <p-button icon="pi pi-trash" severity="danger" class="p-1" (click)="delete(r.id!)"></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Diálogo Detalle -->
<p-dialog header="Detalle de la Incidencia" [(visible)]="detailsVisible" [modal]="true" [style]="{width: '44rem'}">
  <div *ngIf="selected" class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div><strong>ID:</strong> {{ selected.id }}</div>
    <div><strong>Bus:</strong> {{ selected.busPlate }} (ID {{ selected.busId }})</div>
    <div><strong>Ruta:</strong> {{ selected.routeName }} (ID {{ selected.routeId }})</div>

    <div class="md:col-span-2">
      <strong>Descripción:</strong>
      <p class="mt-1">{{ selected.description }}</p>
    </div>

    <div>
      <strong>Severidad:</strong>
      <p-tag [value]="selected.severity" [severity]="severityTag(selected.severity)"></p-tag>
    </div>
    <div>
      <strong>Estado:</strong>
      <p-tag [value]="selected.status" [severity]="statusSeverity(selected.status)"></p-tag>
    </div>

    <div><strong>Reportada:</strong> {{ selected.reportedAt | date:'yyyy-MM-dd HH:mm' }}</div>
    <div *ngIf="selected.resolvedAt"><strong>Resuelta:</strong> {{ selected.resolvedAt | date:'yyyy-MM-dd HH:mm' }}</div>

    <div><strong>Reportó:</strong> {{ selected.reportedBy }}</div>
    <div class="md:col-span-2">
      <strong>Acciones tomadas:</strong>
      <p class="mt-1">{{ selected.actionsTaken || '—' }}</p>
    </div>

    <div class="md:col-span-2 text-xs text-gray-500">
      Creado: {{ selected.createdAt | date:'short' }} · Actualizado: {{ selected.updatedAt | date:'short' }}
    </div>
  </div>
</p-dialog>
